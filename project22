-- Create Database
CREATE DATABASE TrainReservation;
USE TrainReservation;

-- User table
CREATE TABLE Users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    email VARCHAR(100),
    phone VARCHAR(15),
    social_id VARCHAR(100)  -- social network handle (e.g., WhatsApp number, Telegram ID)
);

-- Train table
CREATE TABLE Trains (
    train_id INT AUTO_INCREMENT PRIMARY KEY,
    train_name VARCHAR(100),
    source VARCHAR(50),
    destination VARCHAR(50),
    departure_time DATETIME,
    arrival_time DATETIME,
    seats_available INT
);

-- Ticket table
CREATE TABLE Tickets (
    ticket_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    train_id INT,
    seat_no VARCHAR(10),
    status VARCHAR(20) DEFAULT 'Booked',
    FOREIGN KEY (user_id) REFERENCES Users(user_id),
    FOREIGN KEY (train_id) REFERENCES Trains(train_id)
);

-- Payment table
CREATE TABLE Payments (
    payment_id INT AUTO_INCREMENT PRIMARY KEY,
    ticket_id INT,
    amount DECIMAL(8,2),
    payment_status VARCHAR(20) DEFAULT 'Success',
    FOREIGN KEY (ticket_id) REFERENCES Tickets(ticket_id)
);

-- Social Notification table
CREATE TABLE Social_Notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    ticket_id INT,
    platform VARCHAR(20), -- e.g., WhatsApp, Telegram, Email
    message TEXT,
    sent_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id),
    FOREIGN KEY (ticket_id) REFERENCES Tickets(ticket_id)
);
-- Insert a user
INSERT INTO Users (name, email, phone, social_id)
VALUES ('Rahul Sharma', 'rahul@gmail.com', '9876543210', 'rahul_wa');

-- Insert a train
INSERT INTO Trains (train_name, source, destination, departure_time, arrival_time, seats_available)
VALUES ('Express 101', 'Delhi', 'Mumbai', '2025-08-30 08:00:00', '2025-08-30 20:00:00', 200);

-- Book a ticket
INSERT INTO Tickets (user_id, train_id, seat_no)
VALUES (1, 1, 'A12');

-- Make payment
INSERT INTO Payments (ticket_id, amount, payment_status)
VALUES (1, 1200.00, 'Success');

-- Send notification through social network
INSERT INTO Social_Notifications (user_id, ticket_id, platform, message)
VALUES (1, 1, 'WhatsApp', 'Your ticket A12 for Express 101 is confirmed. Enjoy your journey!');
SELECT u.name, t.train_name, tk.seat_no, p.amount, s.platform, s.message
FROM Tickets tk
JOIN Users u ON tk.user_id = u.user_id
JOIN Trains t ON tk.train_id = t.train_id
JOIN Payments p ON tk.ticket_id = p.ticket_id
JOIN Social_Notifications s ON tk.ticket_id = s.ticket_id
WHERE tk.ticket_id = 1;
SELECT train_name, seats_available 
FROM Trains 
WHERE train_id = 1;
UPDATE Tickets 
SET status = 'Cancelled' 
WHERE ticket_id = 1;
